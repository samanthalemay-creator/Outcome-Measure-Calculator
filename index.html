<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outcome Measure Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        select, input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        select:focus, input:focus {
            border-color: #007bff;
            outline: none;
        }
        .hidden {
            display: none;
        }
        .assessment-info {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .results {
            background-color: #e8f5e8;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #28a745;
        }
        .question {
            background-color: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        .question input {
            width: 100px;
            text-align: center;
        }
        .btn {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .btn-secondary {
            background-color: #6c757d;
        }
        .btn-secondary:hover {
            background-color: #545b62;
        }
        .grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 Outcome Measure Calculator</h1>
            <p>Select an assessment tool to calculate scores and interpretations</p>
        </div>

        <div class="form-group">
            <label for="assessment">Choose Assessment Tool:</label>
            <select id="assessment">
                <option value="">-- Select an Assessment --</option>
                
                <optgroup label="🦴 Upper Extremity">
                    <option value="uefi">Upper Extremity Functional Index (UEFI)</option>
                    <option value="spadi">Shoulder Pain and Disability Index (SPADI)</option>
                    <option value="oss">Oxford Shoulder Score</option>
                </optgroup>
                
                <optgroup label="🦵 Lower Extremity">
                    <option value="lefs">Lower Extremity Functional Scale (LEFS)</option>
                    <option value="oks">Oxford Knee Score</option>
                    <option value="ohs">Oxford Hip Score</option>
                    <option value="lysholm">Lysholm Knee Scoring Scale</option>
                    <option value="ffi">Foot Function Index (FFI)</option>
                </optgroup>
                
                <optgroup label="🏃 Mobility & Gait Assessment">
                    <option value="tug">Timed Up and Go (TUG)</option>
                    <option value="berg">Berg Balance Scale</option>
                    <option value="6mwt">6 Minute Walk Test</option>
                    <option value="10mwt">10 Meter Walk Test</option>
                    <option value="fga">Functional Gait Assessment (FGA)</option>
                    <option value="tinetti">Tinetti Performance Oriented Mobility Assessment</option>
                </optgroup>
                
                <optgroup label="💪 Functional Strength">
                    <option value="30cst">30 Second Chair Stand Test</option>
                    <option value="5tsts">5 Times Sit to Stand Test</option>
                </optgroup>
                
                <optgroup label="🔙 Spine & Neck">
                    <option value="ndi">Neck Disability Index (NDI)</option>
                    <option value="odi">Oswestry Disability Index (ODI)</option>
                    <option value="hdi">Headache Disability Index (HDI)</option>
                </optgroup>
                
                <optgroup label="🔄 General Functional Assessment">
                    <option value="psfs">Patient Specific Functional Scale (PSFS)</option>
                    <option value="ampac">AM-PAC 6 Clicks Short Form</option>
                    <option value="sf36">SF-36 Physical Function</option>
                </optgroup>
            </select>
        </div>

        <div id="assessmentInfo" class="assessment-info hidden">
            <h3 id="assessmentTitle"></h3>
            <div id="assessmentDetails"></div>
        </div>

        <div class="grid">
            <div>
                <div id="questionsSection" class="hidden">
                    <h3>Individual Questions</h3>
                    <div id="questionsContainer"></div>
                    <div id="runningTotal" class="hidden">
                        <strong>Total Score: <span id="totalScore">0</span></strong>
                    </div>
                </div>

                <div id="totalSection" class="hidden">
                    <h3>Or Enter Total Score</h3>
                    <div class="form-group">
                        <label for="totalInput" id="totalLabel">Total Score:</label>
                        <input type="number" id="totalInput" step="0.1">
                        <button class="btn" onclick="calculateFromTotal()">Calculate</button>
                    </div>
                </div>
            </div>

            <div>
                <div id="results" class="results hidden">
                    <h3>📋 Results</h3>
                    <div id="scoreDisplay"></div>
                    <div id="interpretation"></div>
                </div>

                <div id="ranges" class="hidden">
                    <h4>Scoring Ranges:</h4>
                    <div id="rangeInfo"></div>
                </div>
            </div>
        </div>

        <button class="btn btn-secondary" onclick="resetCalculator()">🔄 Reset</button>
    </div>

    <script>
        let currentAssessment = null;

        const assessments = {
            uefi: {
                name: "Upper Extremity Functional Index",
                questions: 20,
                minScore: 0,
                maxScore: 80,
                questionMin: 0,
                questionMax: 4,
                interpretation: function(score) {
                    const percentage = ((80 - score) / 80) * 100;
                    let level;
                    if (percentage <= 10) level = "Minimal disability";
                    else if (percentage <= 30) level = "Moderate disability"; 
                    else if (percentage <= 50) level = "Severe disability";
                    else level = "Complete disability";
                    return { percentage: percentage.toFixed(1) + "%", level };
                },
                ranges: "0-10% = Minimal, 11-30% = Moderate, 31-50% = Severe, >50% = Complete"
            },
            spadi: {
                name: "Shoulder Pain and Disability Index",
                questions: 13,
                minScore: 0,
                maxScore: 130,
                questionMin: 0,
                questionMax: 10,
                interpretation: function(score) {
                    const percentage = (score / 130) * 100;
                    let level;
                    if (percentage <= 10) level = "Minimal disability";
                    else if (percentage <= 30) level = "Moderate disability";
                    else if (percentage <= 50) level = "Severe disability";
                    else level = "Complete disability";
                    return { percentage: percentage.toFixed(1) + "%", level };
                },
                ranges: "0-10% = Minimal, 11-30% = Moderate, 31-50% = Severe, >50% = Complete"
            },
            oss: {
                name: "Oxford Shoulder Score",
                questions: 12,
                minScore: 0,
                maxScore: 48,
                questionMin: 0,
                questionMax: 4,
                interpretation: function(score) {
                    let level;
                    if (score >= 42) level = "Excellent outcome";
                    else if (score >= 34) level = "Good outcome";
                    else if (score >= 27) level = "Fair outcome";
                    else level = "Poor outcome";
                    return { percentage: score + "/48 points", level };
                },
                ranges: "42-48 = Excellent, 34-41 = Good, 27-33 = Fair, 0-26 = Poor"
            },
            lefs: {
                name: "Lower Extremity Functional Scale",
                questions: 20,
                minScore: 0,
                maxScore: 80,
                questionMin: 0,
                questionMax: 4,
                interpretation: function(score) {
                    const percentage = ((80 - score) / 80) * 100;
                    let level;
                    if (percentage <= 10) level = "Minimal disability";
                    else if (percentage <= 30) level = "Moderate disability";
                    else if (percentage <= 50) level = "Severe disability";
                    else level = "Complete disability";
                    return { percentage: percentage.toFixed(1) + "%", level };
                },
                ranges: "0-10% = Minimal, 11-30% = Moderate, 31-50% = Severe, >50% = Complete"
            },
            oks: {
                name: "Oxford Knee Score",
                questions: 12,
                minScore: 0,
                maxScore: 48,
                questionMin: 0,
                questionMax: 4,
                interpretation: function(score) {
                    let level;
                    if (score >= 42) level = "Excellent outcome";
                    else if (score >= 34) level = "Good outcome";
                    else if (score >= 27) level = "Fair outcome";
                    else level = "Poor outcome";
                    return { percentage: score + "/48 points", level };
                },
                ranges: "42-48 = Excellent, 34-41 = Good, 27-33 = Fair, 0-26 = Poor"
            },
            ohs: {
                name: "Oxford Hip Score",
                questions: 12,
                minScore: 0,
                maxScore: 48,
                questionMin: 0,
                questionMax: 4,
                interpretation: function(score) {
                    let level;
                    if (score >= 42) level = "Excellent outcome";
                    else if (score >= 34) level = "Good outcome";
                    else if (score >= 27) level = "Fair outcome";
                    else level = "Poor outcome";
                    return { percentage: score + "/48 points", level };
                },
                ranges: "42-48 = Excellent, 34-41 = Good, 27-33 = Fair, 0-26 = Poor"
            },
            lysholm: {
                name: "Lysholm Knee Scoring Scale",
                questions: 8,
                minScore: 0,
                maxScore: 100,
                questionMin: 0,
                questionMax: 25,
                interpretation: function(score) {
                    let level;
                    if (score >= 95) level = "Excellent";
                    else if (score >= 84) level = "Good";
                    else if (score >= 65) level = "Fair";
                    else level = "Poor";
                    return { percentage: score + "/100 points", level };
                },
                ranges: "95-100 = Excellent, 84-94 = Good, 65-83 = Fair, <65 = Poor"
            },
            ffi: {
                name: "Foot Function Index",
                questions: 23,
                minScore: 0,
                maxScore: 230,
                questionMin: 0,
                questionMax: 10,
                interpretation: function(score) {
                    const percentage = (score / 230) * 100;
                    let level;
                    if (percentage <= 20) level = "Minimal foot disability";
                    else if (percentage <= 40) level = "Mild foot disability";
                    else if (percentage <= 60) level = "Moderate foot disability";
                    else if (percentage <= 80) level = "Severe foot disability";
                    else level = "Complete foot disability";
                    return { percentage: percentage.toFixed(1) + "%", level };
                },
                ranges: "0-20% = Minimal, 21-40% = Mild, 41-60% = Moderate, 61-80% = Severe, 81-100% = Complete"
            },
            berg: {
                name: "Berg Balance Scale", 
                questions: 14,
                minScore: 0,
                maxScore: 56,
                questionMin: 0,
                questionMax: 4,
                interpretation: function(score) {
                    let level;
                    if (score >= 45) level = "Low fall risk";
                    else if (score >= 21) level = "Medium fall risk";
                    else level = "High fall risk";
                    return { percentage: score + "/56 points", level };
                },
                ranges: "45-56 = Low risk, 21-44 = Medium risk, 0-20 = High risk"
            },
            "6mwt": {
                name: "6 Minute Walk Test",
                questions: 1,
                minScore: 0,
                maxScore: 800,
                questionMin: 0,
                questionMax: 800,
                isDistance: true,
                interpretation: function(score) {
                    let level;
                    if (score >= 500) level = "Excellent endurance";
                    else if (score >= 400) level = "Good endurance";
                    else if (score >= 300) level = "Fair endurance";
                    else if (score >= 200) level = "Poor endurance";
                    else level = "Very poor endurance";
                    return { percentage: score + " meters", level };
                },
                ranges: "≥500m = Excellent, 400-499m = Good, 300-399m = Fair, 200-299m = Poor, <200m = Very Poor"
            },
            "10mwt": {
                name: "10 Meter Walk Test",
                questions: 1,
                minScore: 0,
                maxScore: 999,
                questionMin: 0,
                questionMax: 999,
                isTime: true,
                interpretation: function(score) {
                    const speed = 10 / score;
                    let level;
                    if (speed > 1.0) level = "Normal walking speed";
                    else if (speed >= 0.67) level = "Mild walking impairment";
                    else if (speed >= 0.4) level = "Moderate walking impairment";
                    else level = "Severe walking impairment";
                    return { 
                        percentage: speed.toFixed(2) + " m/s", 
                        level: level + " (" + score.toFixed(1) + " seconds)"
                    };
                },
                ranges: ">1.0 m/s = Normal, 0.67-1.0 = Mild, 0.4-0.67 = Moderate, <0.4 = Severe"
            },
            fga: {
                name: "Functional Gait Assessment",
                questions: 10,
                minScore: 0,
                maxScore: 30,
                questionMin: 0,
                questionMax: 3,
                interpretation: function(score) {
                    let level;
                    if (score >= 23) level = "Low fall risk";
                    else if (score >= 19) level = "Moderate fall risk";
                    else level = "High fall risk";
                    return { percentage: score + "/30 points", level };
                },
                ranges: "23-30 = Low risk, 19-22 = Moderate risk, ≤18 = High risk"
            },
            tinetti: {
                name: "Tinetti Performance Oriented Mobility Assessment",
                questions: 16,
                minScore: 0,
                maxScore: 28,
                questionMin: 0,
                questionMax: 2,
                interpretation: function(score) {
                    let level;
                    if (score >= 25) level = "Low fall risk";
                    else if (score >= 19) level = "Moderate fall risk";
                    else level = "High fall risk";
                    return { percentage: score + "/28 points", level };
                },
                ranges: "25-28 = Low risk, 19-24 = Moderate risk, ≤18 = High risk"
            },
            "30cst": {
                name: "30 Second Chair Stand Test",
                questions: 1,
                minScore: 0,
                maxScore: 50,
                questionMin: 0,
                questionMax: 50,
                isCount: true,
                interpretation: function(score) {
                    let level;
                    if (score >= 15) level = "Excellent lower body strength";
                    else if (score >= 12) level = "Good lower body strength";
                    else if (score >= 8) level = "Average lower body strength";
                    else level = "Below average lower body strength";
                    return { percentage: score + " stands", level };
                },
                ranges: "≥15 = Excellent, 12-14 = Good, 8-11 = Average, <8 = Below Average"
            },
            "5tsts": {
                name: "5 Times Sit to Stand Test",
                questions: 1,
                minScore: 0,
                maxScore: 999,
                questionMin: 0,
                questionMax: 999,
                isTime: true,
                interpretation: function(score) {
                    let level;
                    if (score <= 11) level = "Normal functional mobility - Low fall risk";
                    else if (score <= 13.6) level = "Mild functional limitation - Slightly increased fall risk";
                    else if (score <= 16.6) level = "Moderate functional limitation - Moderate fall risk";
                    else level = "Significant functional limitation - High fall risk";
                    return { percentage: score.toFixed(1) + " seconds", level };
                },
                ranges: "≤11s = Normal, 11.1-13.6s = Mild, 13.7-16.6s = Moderate, >16.6s = Significant"
            },
            ndi: {
                name: "Neck Disability Index",
                questions: 10,
                minScore: 0,
                maxScore: 50,
                questionMin: 0,
                questionMax: 5,
                interpretation: function(score) {
                    const percentage = (score / 50) * 100;
                    let level;
                    if (percentage <= 4) level = "No disability";
                    else if (percentage <= 14) level = "Mild disability";
                    else if (percentage <= 24) level = "Moderate disability";
                    else if (percentage <= 34) level = "Severe disability";
                    else level = "Complete disability";
                    return { percentage: percentage.toFixed(1) + "%", level };
                },
                ranges: "0-4% = None, 5-14% = Mild, 15-24% = Moderate, 25-34% = Severe, ≥35% = Complete"
            },
            odi: {
                name: "Oswestry Disability Index",
                questions: 10,
                minScore: 0,
                maxScore: 50,
                questionMin: 0,
                questionMax: 5,
                interpretation: function(score) {
                    const percentage = (score / 50) * 100;
                    let level;
                    if (percentage <= 20) level = "Minimal disability";
                    else if (percentage <= 40) level = "Moderate disability";
                    else if (percentage <= 60) level = "Severe disability";
                    else if (percentage <= 80) level = "Crippled";
                    else level = "Bed-bound/exaggerating";
                    return { percentage: percentage.toFixed(1) + "%", level };
                },
                ranges: "0-20% = Minimal, 21-40% = Moderate, 41-60% = Severe, 61-80% = Crippled, 81-100% = Bed-bound"
            },
            hdi: {
                name: "Headache Disability Index",
                questions: 25,
                minScore: 0,
                maxScore: 100,
                questionMin: 0,
                questionMax: 4,
                interpretation: function(score) {
                    let level;
                    if (score <= 30) level = "Little or no disability";
                    else if (score <= 50) level = "Mild disability";
                    else if (score <= 70) level = "Moderate disability";
                    else level = "Severe disability";
                    return { percentage: score + "/100 points", level };
                },
                ranges: "0-30 = Little/no disability, 31-50 = Mild, 51-70 = Moderate, 71-100 = Severe"
            },
            ampac: {
                name: "AM-PAC 6 Clicks Short Form",
                questions: 6,
                minScore: 6,
                maxScore: 24,
                questionMin: 1,
                questionMax: 4,
                interpretation: function(score) {
                    // Correct AM-PAC conversion table with standardized scores
                    const conversionTable = {
                        24: { standardizedScore: 100, impairmentPercent: 0 },
                        23: { standardizedScore: 95.70, impairmentPercent: 4 },
                        22: { standardizedScore: 90.55, impairmentPercent: 9 },
                        21: { standardizedScore: 80.52, impairmentPercent: 19 },
                        20: { standardizedScore: 75.60, impairmentPercent: 24 },
                        19: { standardizedScore: 70.42, impairmentPercent: 30 },
                        18: { standardizedScore: 64.91, impairmentPercent: 35 },
                        17: { standardizedScore: 59.69, impairmentPercent: 40 },
                        16: { standardizedScore: 55.12, impairmentPercent: 45 },
                        15: { standardizedScore: 50.68, impairmentPercent: 49 },
                        14: { standardizedScore: 45.44, impairmentPercent: 55 },
                        13: { standardizedScore: 40.22, impairmentPercent: 60 },
                        12: { standardizedScore: 35.83, impairmentPercent: 64 },
                        11: { standardizedScore: 30.74, impairmentPercent: 69 },
                        10: { standardizedScore: 25.80, impairmentPercent: 74 },
                        9: { standardizedScore: 20.91, impairmentPercent: 79 },
                        8: { standardizedScore: 15.69, impairmentPercent: 84 },
                        7: { standardizedScore: 10.69, impairmentPercent: 89 },
                        6: { standardizedScore: 0, impairmentPercent: 100 }
                    };
                    
                    const conversion = conversionTable[score] || { standardizedScore: 0, impairmentPercent: 100 };
                    
                    // Determine functional level based on standardized score
                    let functionalLevel, dischargeRisk;
                    if (conversion.standardizedScore >= 75) {
                        functionalLevel = "High functional mobility - Independent";
                        dischargeRisk = "Low risk for institutional discharge";
                    } else if (conversion.standardizedScore >= 50) {
                        functionalLevel = "Moderate functional mobility - Some assistance";
                        dischargeRisk = "Low-moderate risk for institutional discharge";
                    } else if (conversion.standardizedScore >= 25) {
                        functionalLevel = "Limited functional mobility - Assistance needed";
                        dischargeRisk = "Moderate-high risk for institutional discharge";
                    } else {
                        functionalLevel = "Minimal functional mobility - Significant assistance required";
                        dischargeRisk = "High risk for institutional discharge";
                    }
                    
                    return { 
                        percentage: conversion.impairmentPercent + "% impairment",
                        level: functionalLevel,
                        riskLevel: dischargeRisk
                    };
                },
                ranges: "Raw 20-24 = 0-39% impairment, Raw 14-19 = 40-59% impairment, Raw 9-13 = 60-79% impairment, Raw 7-8 = 80-99% impairment, Raw 6 = 100% impairment"
            },
            sf36: {
                name: "SF-36 Physical Function",
                questions: 10,
                minScore: 10,
                maxScore: 30,
                questionMin: 1,
                questionMax: 3,
                interpretation: function(score) {
                    const transformed = ((score - 10) / 20) * 100;
                    let level;
                    if (transformed >= 85) level = "Excellent physical function";
                    else if (transformed >= 70) level = "Good physical function";
                    else if (transformed >= 50) level = "Fair physical function";
                    else if (transformed >= 25) level = "Poor physical function";
                    else level = "Very poor physical function";
                    return { 
                        percentage: "Raw: " + score + ", Transformed: " + transformed.toFixed(1) + "%", 
                        level 
                    };
                },
                ranges: "85-100% = Excellent, 70-84% = Good, 50-69% = Fair, 25-49% = Poor, 0-24% = Very Poor"
            },
            tug: {
                name: "Timed Up and Go",
                questions: 1,
                minScore: 0,
                maxScore: 999,
                questionMin: 0,
                questionMax: 999,
                isTime: true,
                interpretation: function(score) {
                    let level, risk;
                    if (score <= 10) {
                        level = "Normal mobility";
                        risk = "Low fall risk";
                    } else if (score <= 20) {
                        level = "Mild impairment";
                        risk = "Moderate fall risk";
                    } else if (score <= 30) {
                        level = "Moderate impairment"; 
                        risk = "High fall risk";
                    } else {
                        level = "Severe impairment";
                        risk = "Very high fall risk";
                    }
                    return { 
                        percentage: score.toFixed(1) + " seconds", 
                        level: level + " - " + risk 
                    };
                },
                ranges: "≤10s = Normal, 11-20s = Mild, 21-30s = Moderate, >30s = Severe"
            },
            psfs: {
                name: "Patient Specific Functional Scale",
                questions: 3,
                minScore: 0,
                maxScore: 30,
                questionMin: 0,
                questionMax: 10,
                interpretation: function(score) {
                    const avg = score / 3;
                    let level;
                    if (avg >= 8) level = "Minimal limitation";
                    else if (avg >= 6) level = "Mild limitation";
                    else if (avg >= 4) level = "Moderate limitation";
                    else if (avg >= 2) level = "Severe limitation";
                    else level = "Complete limitation";
                    return { 
                        percentage: "Average: " + avg.toFixed(1), 
                        level: level + " (Total: " + score + "/30)"
                    };
                },
                ranges: "8-10 = Minimal, 6-7.9 = Mild, 4-5.9 = Moderate, 2-3.9 = Severe, <2 = Complete"
            }
        };

        document.getElementById('assessment').addEventListener('change', function() {
            const value = this.value;
            if (value && assessments[value]) {
                currentAssessment = assessments[value];
                showAssessment();
            } else {
                hideAllSections();
            }
        });

        function showAssessment() {
            document.getElementById('assessmentTitle').textContent = currentAssessment.name;
            document.getElementById('assessmentDetails').innerHTML = 
                '<strong>Questions:</strong> ' + currentAssessment.questions + ' | ' +
                '<strong>Score Range:</strong> ' + currentAssessment.minScore + '-' + currentAssessment.maxScore;
            document.getElementById('assessmentInfo').classList.remove('hidden');

            createQuestions();
            document.getElementById('questionsSection').classList.remove('hidden');
            
            let labelText;
            if (currentAssessment.isTime) {
                labelText = "Time (seconds):";
            } else if (currentAssessment.isDistance) {
                labelText = "Distance (meters):";
            } else if (currentAssessment.isCount) {
                labelText = "Number of stands:";
            } else {
                labelText = "Total Score:";
            }
            document.getElementById('totalLabel').textContent = labelText;
            document.getElementById('totalSection').classList.remove('hidden');

            document.getElementById('rangeInfo').textContent = currentAssessment.ranges;
            document.getElementById('ranges').classList.remove('hidden');
        }

        function createQuestions() {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';

            for (let i = 1; i <= currentAssessment.questions; i++) {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                
                let questionLabel;
                if (currentAssessment.questions === 1) {
                    if (currentAssessment.isTime) {
                        questionLabel = "Time (seconds):";
                    } else if (currentAssessment.isDistance) {
                        questionLabel = "Distance (meters):";
                    } else if (currentAssessment.isCount) {
                        questionLabel = "Number of stands:";
                    } else {
                        questionLabel = "Score:";
                    }
                } else if (currentAssessment.name.includes('PSFS')) {
                    questionLabel = "Activity " + i + ":";
                } else {
                    questionLabel = "Question " + i + ":";
                }

                const stepValue = (currentAssessment.isTime || currentAssessment.name === "10 Meter Walk Test") ? '0.1' : '1';

                questionDiv.innerHTML = 
                    '<label>' + questionLabel + '</label>' +
                    '<input type="number" ' +
                           'id="q' + i + '" ' +
                           'min="' + currentAssessment.questionMin + '" ' +
                           'max="' + currentAssessment.questionMax + '" ' +
                           'step="' + stepValue + '"' +
                           'oninput="updateRunningTotal()">' +
                    '<small>Range: ' + currentAssessment.questionMin + '-' + currentAssessment.questionMax + '</small>';
                
                container.appendChild(questionDiv);
            }

            document.getElementById('runningTotal').classList.remove('hidden');
            updateRunningTotal();
        }

        function updateRunningTotal() {
            let total = 0;
            let allAnswered = true;

            for (let i = 1; i <= currentAssessment.questions; i++) {
                const input = document.getElementById('q' + i);
                const value = parseFloat(input.value);
                
                if (isNaN(value) || input.value === '') {
                    allAnswered = false;
                } else {
                    total += value;
                }
            }

            document.getElementById('totalScore').textContent = total.toFixed(1);

            if (allAnswered) {
                showResults(total);
            } else {
                document.getElementById('results').classList.add('hidden');
            }
        }

        function calculateFromTotal() {
            const input = document.getElementById('totalInput');
            const value = parseFloat(input.value);
            
            if (!isNaN(value) && value >= currentAssessment.minScore && value <= currentAssessment.maxScore) {
                showResults(value);
            } else {
                alert('Please enter a valid score between ' + currentAssessment.minScore + ' and ' + currentAssessment.maxScore);
            }
        }

        function showResults(score) {
            const result = currentAssessment.interpretation(score);
            
            let scoreDisplayText = result.percentage;
            let interpretationText = '<div style="font-size: 1.1em;"><strong>' + result.level + '</strong></div>';
            
            // Special handling for AM-PAC to show simplified results
            if (currentAssessment.name.includes('AM-PAC')) {
                scoreDisplayText = result.percentage;
                interpretationText = 
                    '<div style="font-size: 1.1em; margin-bottom: 10px;"><strong>' + result.level + '</strong></div>' +
                    '<div style="font-size: 0.9em; color: #666;">' + result.riskLevel + '</div>';
            }
            
            document.getElementById('scoreDisplay').innerHTML = 
                '<div style="font-size: 1.5em; margin-bottom: 10px;"><strong>' + scoreDisplayText + '</strong></div>';
            
            document.getElementById('interpretation').innerHTML = interpretationText;
            
            document.getElementById('results').classList.remove('hidden');
        }

        function hideAllSections() {
            document.getElementById('assessmentInfo').classList.add('hidden');
            document.getElementById('questionsSection').classList.add('hidden');
            document.getElementById('totalSection').classList.add('hidden');
            document.getElementById('results').classList.add('hidden');
            document.getElementById('ranges').classList.add('hidden');
        }

        function resetCalculator() {
            document.getElementById('assessment').value = '';
            document.getElementById('totalInput').value = '';
            hideAllSections();
            currentAssessment = null;
        }
    </script>
</body>
</html>
